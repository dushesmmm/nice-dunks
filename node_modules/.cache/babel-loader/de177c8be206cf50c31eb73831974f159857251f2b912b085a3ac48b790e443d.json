{"ast":null,"code":"import React,{useState,useEffect}from'react';import classes from'./Cart.module.css';import{useCart}from'./CartContext';import axios from'axios';import CongratulationsModal from'./CongratulationsModal';import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";const Cart=_ref=>{let{onClose}=_ref;const{cart,removeFromCart,clearCart,closeCart}=useCart();const[fullName,setFullName]=useState('');const[telegram,setTelegram]=useState('');const[totalPrice,setTotalPrice]=useState(0);const[showCongratulations,setShowCongratulations]=useState(false);const[showCart,setShowCart]=useState(false);const[isCartOpen,setIsCartOpen]=useState(false);const[orderNumber,setOrderNumber]=useState(null);useEffect(()=>{const totalPrice=cart.reduce((acc,item)=>acc+item.price,0);setTotalPrice(totalPrice);setShowCart(true);},[cart]);const handleFullNameChange=e=>{setFullName(e.target.value);};const handleTelegramChange=e=>{setTelegram(e.target.value);};const handleOrderSubmit=async()=>{try{const orderData={fio:fullName,telegram:telegram,order:cart.map(item=>({name:item.brand+' '+item.color,size:item.size+' US',vendorCode:item.vendorCode,price:item.price+\" ₽\"})),total:totalPrice+\" ₽\"};const response=await axios.post('https://nicedunks.ru/api/cart',orderData);const orderNumber=response.data.order_number;setOrderNumber(orderNumber);setShowCongratulations(true);}catch(error){}};const handleCongratulationsClose=()=>{setShowCongratulations(false);clearCart();onClose();};const handleCloseCart=()=>{setIsCartOpen(false);};const handleOpenCart=()=>{setIsCartOpen(true);};useEffect(()=>{const handleKeyPress=event=>{if(event.key==='Escape'){onClose();}};if(isCartOpen){window.addEventListener('keydown',handleKeyPress);}return()=>{window.removeEventListener('keydown',handleKeyPress);};},[isCartOpen]);useEffect(()=>{if(cart.length===0){onClose();// вызываем onClose, если cart пуст\n}},[cart,onClose]);return/*#__PURE__*/_jsxs(\"div\",{className:\"\".concat(classes.CartOverlay,\" \").concat(showCart?classes.show:''),onClick:handleOpenCart,children:[/*#__PURE__*/_jsxs(\"div\",{className:\"\".concat(classes.Cart,\" \").concat(showCart?classes.show:''),children:[/*#__PURE__*/_jsx(\"div\",{onClick:onClose,className:classes.CartClose,children:\"X\"}),/*#__PURE__*/_jsx(\"div\",{className:classes.CartItems,children:cart.map((item,index)=>/*#__PURE__*/_jsxs(\"div\",{className:classes.CartItem,children:[/*#__PURE__*/_jsx(\"div\",{className:classes.CartImage__container,children:/*#__PURE__*/_jsx(\"img\",{src:item.img,alt:\"\\u0438\\u0437\\u043E\\u0431\\u0440\\u0430\\u0436\\u0435\\u043D\\u0438\\u0435 \\u0442\\u043E\\u0432\\u0430\\u0440\\u0430\"})}),/*#__PURE__*/_jsxs(\"div\",{className:classes.CartItem__description,children:[/*#__PURE__*/_jsx(\"div\",{children:item.brand}),/*#__PURE__*/_jsx(\"div\",{style:{marginTop:10},children:item.color}),/*#__PURE__*/_jsx(\"p\",{style:{marginTop:20,cursor:'pointer'},onClick:()=>removeFromCart(index),children:\"\\u0423\\u0434\\u0430\\u043B\\u0438\\u0442\\u044C\"}),/*#__PURE__*/_jsxs(\"div\",{className:classes.CartItemInfo,children:[/*#__PURE__*/_jsxs(\"div\",{className:classes.CartItemSize,children:[item.size,\" US\"]}),/*#__PURE__*/_jsxs(\"div\",{children:[item.price,\" \\u20BD\"]})]})]})]},index))}),/*#__PURE__*/_jsxs(\"form\",{className:classes.Checkout,children:[/*#__PURE__*/_jsx(\"div\",{children:\"\\u0417\\u0430\\u043F\\u043E\\u043B\\u043D\\u0438\\u0442\\u0435 \\u0441\\u0432\\u043E\\u0438 \\u0434\\u0430\\u043D\\u043D\\u044B\\u0435 \\u0438 \\u043C\\u044B \\u0441\\u0440\\u0430\\u0437\\u0443 \\u0441\\u0432\\u044F\\u0436\\u0435\\u043C\\u0441\\u044F \\u0441 \\u0432\\u0430\\u043C\\u0438\"}),/*#__PURE__*/_jsx(\"input\",{type:\"text\",placeholder:\"\\u0414\\u0436\\u043E\\u0440\\u0434\\u0430\\u043D \\u041C\\u0430\\u0439\\u043A\\u043B \\u041F\\u0435\\u0440\\u0432\\u044B\\u0439\",value:fullName,onChange:handleFullNameChange,className:classes.CheckoutInput,required:true}),/*#__PURE__*/_jsx(\"input\",{type:\"text\",placeholder:\"@nicedunks\",value:telegram,onChange:handleTelegramChange,className:classes.CheckoutInput,required:true}),/*#__PURE__*/_jsxs(\"div\",{className:classes.Total,children:[/*#__PURE__*/_jsx(\"div\",{children:\"\\u0418\\u0422\\u041E\\u0413\\u041E: \"}),/*#__PURE__*/_jsxs(\"div\",{children:[totalPrice,\" \\u20BD\"]})]}),/*#__PURE__*/_jsx(\"button\",{type:\"button\",onClick:handleOrderSubmit,className:classes.CheckoutButton,children:\"\\u041E\\u0424\\u041E\\u0420\\u041C\\u0418\\u0422\\u042C\"})]})]}),showCongratulations&&/*#__PURE__*/_jsx(CongratulationsModal,{onClose:handleCongratulationsClose,orderNumber:orderNumber})]});};export default Cart;","map":{"version":3,"names":["React","useState","useEffect","classes","useCart","axios","CongratulationsModal","jsx","_jsx","jsxs","_jsxs","Cart","_ref","onClose","cart","removeFromCart","clearCart","closeCart","fullName","setFullName","telegram","setTelegram","totalPrice","setTotalPrice","showCongratulations","setShowCongratulations","showCart","setShowCart","isCartOpen","setIsCartOpen","orderNumber","setOrderNumber","reduce","acc","item","price","handleFullNameChange","e","target","value","handleTelegramChange","handleOrderSubmit","orderData","fio","order","map","name","brand","color","size","vendorCode","total","response","post","data","order_number","error","handleCongratulationsClose","handleCloseCart","handleOpenCart","handleKeyPress","event","key","window","addEventListener","removeEventListener","length","className","concat","CartOverlay","show","onClick","children","CartClose","CartItems","index","CartItem","CartImage__container","src","img","alt","CartItem__description","style","marginTop","cursor","CartItemInfo","CartItemSize","Checkout","type","placeholder","onChange","CheckoutInput","required","Total","CheckoutButton"],"sources":["D:/project/nicedunks/nicedunks/src/components/Cart/Cart.jsx"],"sourcesContent":["import React, { useState, useEffect } from 'react';\r\nimport classes from './Cart.module.css';\r\nimport { useCart } from './CartContext';\r\nimport axios from 'axios';\r\nimport CongratulationsModal from './CongratulationsModal';\r\n\r\nconst Cart = ({ onClose }) => {\r\n  const { cart, removeFromCart, clearCart, closeCart } = useCart();\r\n  const [fullName, setFullName] = useState('');\r\n  const [telegram, setTelegram] = useState('');\r\n  const [totalPrice, setTotalPrice] = useState(0);\r\n  const [showCongratulations, setShowCongratulations] = useState(false);\r\n  const [showCart, setShowCart] = useState(false);\r\n  const [isCartOpen, setIsCartOpen] = useState(false);\r\n  const [orderNumber, setOrderNumber] = useState(null);\r\n\r\n  useEffect(() => {\r\n    const totalPrice = cart.reduce((acc, item) => acc + item.price, 0);\r\n    setTotalPrice(totalPrice);\r\n    setShowCart(true); \r\n  }, [cart]);\r\n\r\n  const handleFullNameChange = (e) => {\r\n    setFullName(e.target.value);\r\n  };\r\n\r\n  const handleTelegramChange = (e) => {\r\n    setTelegram(e.target.value);\r\n  };\r\n\r\n  const handleOrderSubmit = async () => {\r\n    try {\r\n      const orderData = {\r\n        fio: fullName,\r\n        telegram: telegram,\r\n        order: cart.map((item) => ({\r\n          name: item.brand + ' ' + item.color,\r\n          size: item.size + ' US',\r\n          vendorCode: item.vendorCode,\r\n          price: item.price + \" ₽\"\r\n        })),\r\n        total: totalPrice + \" ₽\"\r\n      };\r\n      \r\n      const response = await axios.post('https://nicedunks.ru/api/cart', orderData);\r\n      const orderNumber = response.data.order_number;\r\n      setOrderNumber(orderNumber);\r\n      setShowCongratulations(true);\r\n    } catch (error) {\r\n    }\r\n  };\r\n\r\n  const handleCongratulationsClose = () => {\r\n    setShowCongratulations(false);\r\n    clearCart();\r\n    onClose();\r\n  };\r\n\r\n  const handleCloseCart = () => {\r\n    setIsCartOpen(false);\r\n  };\r\n\r\n  const handleOpenCart = () => {\r\n    setIsCartOpen(true);\r\n  };\r\n\r\n  useEffect(() => {\r\n    const handleKeyPress = (event) => {\r\n      if (event.key === 'Escape') {\r\n        onClose();\r\n      }\r\n    };\r\n\r\n    if (isCartOpen) {\r\n      window.addEventListener('keydown', handleKeyPress);\r\n    }\r\n\r\n    return () => {\r\n      window.removeEventListener('keydown', handleKeyPress);\r\n    };\r\n  }, [isCartOpen]);\r\n\r\n  useEffect(() => {\r\n    if (cart.length === 0) {\r\n      onClose(); // вызываем onClose, если cart пуст\r\n    }\r\n  }, [cart, onClose]);\r\n\r\n\r\n\r\n  return (\r\n    <div className={`${classes.CartOverlay} ${showCart ? classes.show : ''}`} onClick={handleOpenCart}>\r\n      <div className={`${classes.Cart} ${showCart ? classes.show : ''}`}>\r\n        <div onClick={onClose} className={classes.CartClose}>\r\n          X\r\n        </div>\r\n        <div className={classes.CartItems}>\r\n          {cart.map((item, index) => (\r\n            <div key={index} className={classes.CartItem}>\r\n              <div className={classes.CartImage__container}>\r\n              <img src={item.img} alt=\"изображение товара\" />\r\n              </div>\r\n              <div className={classes.CartItem__description}>\r\n                <div>{item.brand}</div>\r\n                <div style={{ marginTop: 10 }}>{item.color}</div>\r\n                <p style={{ marginTop: 20, cursor: 'pointer' }} onClick={() => removeFromCart(index)}>\r\n                  Удалить\r\n                </p>\r\n                <div className={classes.CartItemInfo}>\r\n                  <div className={classes.CartItemSize}>{item.size} US</div>\r\n                  <div>{item.price} ₽</div>\r\n                </div>\r\n              </div>\r\n            </div>\r\n          ))}\r\n        </div>\r\n        <form className={classes.Checkout}>\r\n          <div>Заполните свои данные и мы сразу свяжемся с вами</div>\r\n          <input\r\n            type=\"text\"\r\n            placeholder=\"Джордан Майкл Первый\"\r\n            value={fullName}\r\n            onChange={handleFullNameChange}\r\n            className={classes.CheckoutInput}\r\n            required\r\n          />\r\n          <input\r\n            type=\"text\"\r\n            placeholder=\"@nicedunks\"\r\n            value={telegram}\r\n            onChange={handleTelegramChange}\r\n            className={classes.CheckoutInput}\r\n            required\r\n          />\r\n          <div className={classes.Total}>\r\n            <div>ИТОГО: </div>\r\n            <div>{totalPrice} ₽</div>\r\n          </div>\r\n          <button type='button' onClick={handleOrderSubmit} className={classes.CheckoutButton}>\r\n            ОФОРМИТЬ\r\n          </button>\r\n        </form>\r\n      </div>\r\n      {showCongratulations && <CongratulationsModal onClose={handleCongratulationsClose} orderNumber={orderNumber}/>}\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default Cart;\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}